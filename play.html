<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Play ‚Äî Classrom.GG</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080810;
    --bg2: #0c0c18;
    --card: #10101e;
    --card2: #14142a;
    --border: #1c1c34;
    --border2: #242440;
    --accent: #00ffaa;
    --accent2: #ff3e6c;
    --accent3: #7c3aed;
    --text: #dde4f0;
    --muted: #3a3a5c;
    --muted2: #6b7280;
    --muted3: #9ca3af;
    --glow-g: 0 0 28px rgba(0,255,170,0.28);
    --glow-p: 0 0 28px rgba(124,58,237,0.28);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior: smooth; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::after {
    content:'';
    position:fixed; inset:0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.055) 2px, rgba(0,0,0,0.055) 4px);
    pointer-events:none; z-index:9999;
  }

  /* ‚ïê‚ïê TOPBAR ‚ïê‚ïê */
  .topbar {
    height: 50px;
    display: flex; align-items: center;
    border-bottom: 1px solid var(--border);
    background: rgba(8,8,16,0.97);
    backdrop-filter: blur(14px);
    position: sticky; top: 0; z-index: 200;
  }
  .logo-block {
    width: 240px; flex-shrink: 0;
    padding: 0 18px;
    border-right: 1px solid var(--border);
    height: 100%; display: flex; align-items: center;
  }
  .logo {
    font-family: 'Press Start 2P', monospace;
    font-size: 10px; color: var(--accent);
    text-shadow: 0 0 18px rgba(0,255,170,0.55);
    text-decoration: none; letter-spacing: 1px;
  }
  .logo em { font-style:normal; color: var(--accent2); }
  .topbar-mid {
    flex: 1; display: flex; align-items: center;
    gap: 12px; padding: 0 18px; overflow: hidden;
  }
  .back-link {
    display:flex; align-items:center; gap:5px;
    color:var(--muted3); text-decoration:none;
    font-weight:700; font-size:11px; letter-spacing:1px;
    text-transform:uppercase; transition:color .2s;
    white-space:nowrap; flex-shrink:0;
  }
  .back-link:hover { color:var(--accent); }
  .sep { width:1px; height:18px; background:var(--border2); flex-shrink:0; }
  .nav-title {
    font-family:'Press Start 2P', monospace;
    font-size:8px; color:#fff;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .topbar-right {
    display:flex; align-items:center; gap:8px;
    padding:0 14px; flex-shrink:0;
  }
  .tbadge {
    padding:3px 9px; border-radius:4px;
    font-size:9px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase;
  }
  .tbadge-html { background:rgba(14,165,233,.13); color:#38bdf8; border:1px solid rgba(14,165,233,.22); }
  .tbadge-swf  { background:rgba(255,62,108,.13);  color:#fb7185; border:1px solid rgba(255,62,108,.22); }
  .ibtn {
    width:32px; height:32px;
    display:flex; align-items:center; justify-content:center;
    background:var(--card); border:1px solid var(--border);
    border-radius:6px; color:var(--muted3);
    cursor:pointer; font-size:14px; transition:all .18s;
  }
  .ibtn:hover { border-color:var(--accent); color:var(--accent); box-shadow:var(--glow-g); }

  /* ‚ïê‚ïê PAGE BODY ‚ïê‚ïê */
  .page-body { display:flex; align-items:flex-start; }

  /* ‚ïê‚ïê CONTENT COL ‚ïê‚ïê */
  .content-col { flex:1; min-width:0; display:flex; flex-direction:column; }

  /* game viewport */
  .viewport-wrap {
    width:100%; aspect-ratio:16/9;
    position:relative; background:#000; overflow:hidden;
  }
  #html5-frame { width:100%; height:100%; border:none; display:none; }
  #ruffle-wrap {
    width:100%; height:100%;
    display:none; align-items:center; justify-content:center;
  }
  #ruffle-wrap > * { width:100%!important; height:100%!important; }

  /* overlay */
  .ov {
    position:absolute; inset:0;
    background:radial-gradient(ellipse at 50% 40%, #0e0e28 0%, #000 100%);
    display:flex; flex-direction:column;
    align-items:center; justify-content:center; gap:18px;
    z-index:10; transition:opacity .4s;
  }
  .ov.fade { opacity:0; pointer-events:none; }
  .ov-icon { font-size:52px; animation:floatY 3s ease-in-out infinite; }
  @keyframes floatY { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
  .ov-label { font-family:'Press Start 2P',monospace; font-size:10px; color:var(--accent); text-shadow:0 0 22px rgba(0,255,170,.65); letter-spacing:2px; }
  .ov-sub { color:var(--muted3); font-size:13px; font-weight:600; }
  .ov-track { width:160px; height:3px; background:var(--border); border-radius:2px; overflow:hidden; }
  .ov-bar { height:100%; background:linear-gradient(90deg,var(--accent3),var(--accent)); border-radius:2px; animation:scan 1.9s ease-in-out infinite; }
  @keyframes scan { 0%{width:0;margin-left:0} 50%{width:55%;margin-left:20%} 100%{width:0;margin-left:100%} }

  .err-ov {
    position:absolute; inset:0; background:#000;
    display:none; flex-direction:column;
    align-items:center; justify-content:center;
    gap:14px; text-align:center; padding:40px; z-index:11;
  }
  .err-ov.show { display:flex; }
  .err-ov h2 { font-family:'Press Start 2P',monospace; font-size:11px; color:var(--accent2); }
  .err-ov p { color:var(--muted3); max-width:340px; line-height:1.9; font-size:14px; }

  /* info bar */
  .info-bar {
    display:flex; align-items:center; gap:14px;
    padding:12px 18px;
    background:var(--card); border-bottom:1px solid var(--border);
  }
  .gname { flex:1; font-size:20px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .act-btn {
    padding:7px 16px; border-radius:6px;
    border:1px solid var(--border);
    background:transparent; color:var(--muted3);
    font-family:'Rajdhani',sans-serif; font-size:12px; font-weight:700;
    letter-spacing:1px; text-transform:uppercase;
    cursor:pointer; transition:all .18s; white-space:nowrap;
  }
  .act-btn:hover { border-color:var(--accent); color:var(--accent); }
  .act-btn.ok { border-color:var(--accent); color:var(--accent); }

  /* meta chips */
  .game-meta {
    display:flex; gap:8px; align-items:center;
    padding:12px 18px; flex-wrap:wrap;
    border-bottom:1px solid var(--border);
  }
  .chip {
    display:flex; align-items:center; gap:5px;
    padding:4px 12px; border-radius:999px;
    background:var(--card2); border:1px solid var(--border2);
    font-size:12px; font-weight:600; color:var(--muted3);
  }

  /* ‚ïê‚ïê MORE GAMES BELOW ‚ïê‚ïê */
  .more-section { padding:26px 18px 48px; }
  .section-hd {
    display:flex; align-items:center; gap:12px;
    margin-bottom:16px;
  }
  .section-hd h2 {
    font-family:'Press Start 2P',monospace;
    font-size:9px; color:var(--muted2);
    letter-spacing:2px; text-transform:uppercase;
  }
  .section-hd h2 span { color:var(--accent); }
  .view-all {
    margin-left:auto; color:var(--accent3);
    text-decoration:none; font-size:12px; font-weight:700;
    letter-spacing:1px; text-transform:uppercase; transition:color .18s;
  }
  .view-all:hover { color:var(--accent); }

  .more-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));
    gap:12px;
  }
  .gcard {
    background:var(--card); border:1px solid var(--border);
    border-radius:8px; overflow:hidden;
    text-decoration:none; color:inherit; display:block;
    transition:transform .18s, border-color .18s, box-shadow .18s;
    animation:fadeUp .35s ease both;
  }
  .gcard:hover { transform:translateY(-3px); border-color:var(--accent3); box-shadow:var(--glow-p); }
  @keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
  .gcard-thumb {
    aspect-ratio:16/9;
    background:linear-gradient(135deg,#12122a,#1a1a40);
    display:flex; align-items:center; justify-content:center;
    font-size:28px; position:relative; overflow:hidden;
  }
  .gcard-thumb::after {
    content:'‚ñ∂'; position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    font-size:20px; color:rgba(255,255,255,0); background:rgba(0,0,0,0); transition:all .2s;
  }
  .gcard:hover .gcard-thumb::after { color:rgba(255,255,255,.9); background:rgba(0,0,0,.52); }
  .gcard-body { padding:8px 10px 10px; }
  .gcard-name { font-size:12px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; margin-bottom:5px; }
  .mbadge { font-size:9px; font-weight:700; letter-spacing:1px; padding:2px 7px; border-radius:3px; text-transform:uppercase; }
  .mbadge-html { background:rgba(14,165,233,.13); color:#38bdf8; }
  .mbadge-swf  { background:rgba(255,62,108,.13);  color:#fb7185; }

  /* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
  .sidebar {
    width:240px; flex-shrink:0;
    border-left:1px solid var(--border);
    background:var(--bg2);
    height:calc(100vh - 50px);
    position:sticky; top:50px;
    display:flex; flex-direction:column; overflow:hidden;
  }
  .sb-head { padding:14px 14px 10px; border-bottom:1px solid var(--border); flex-shrink:0; }
  .sb-head-title { font-family:'Press Start 2P',monospace; font-size:8px; color:var(--muted2); letter-spacing:2px; text-transform:uppercase; }
  .sb-head-title span { color:var(--accent); }
  .sb-search { padding:10px 10px 8px; border-bottom:1px solid var(--border); flex-shrink:0; }
  .sb-search input {
    width:100%; padding:7px 11px;
    background:var(--card); border:1px solid var(--border);
    border-radius:6px; color:var(--text);
    font-family:'Rajdhani',sans-serif; font-size:13px; font-weight:600;
    outline:none; transition:border-color .2s;
  }
  .sb-search input:focus { border-color:var(--accent3); }
  .sb-search input::placeholder { color:var(--muted); }
  .sb-tabs { display:flex; gap:5px; padding:7px 10px; border-bottom:1px solid var(--border); flex-shrink:0; }
  .stab {
    flex:1; padding:4px 0; text-align:center;
    border-radius:5px; border:1px solid var(--border);
    background:transparent; color:var(--muted2);
    font-family:'Rajdhani',sans-serif; font-size:11px; font-weight:700;
    letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all .15s;
  }
  .stab.active         { background:var(--accent3); border-color:var(--accent3); color:#fff; }
  .stab.active.t-html  { background:#0ea5e9; border-color:#0ea5e9; }
  .stab.active.t-swf   { background:var(--accent2); border-color:var(--accent2); }
  .sb-list { flex:1; overflow-y:auto; padding:6px; }
  .sb-list::-webkit-scrollbar { width:3px; }
  .sb-list::-webkit-scrollbar-thumb { background:var(--border2); border-radius:2px; }
  .sb-item {
    display:flex; align-items:center; gap:9px;
    padding:7px 9px; border-radius:7px;
    cursor:pointer; text-decoration:none; color:inherit;
    transition:background .14s; border:1px solid transparent; margin-bottom:2px;
  }
  .sb-item:hover { background:var(--card2); border-color:var(--border); }
  .sb-item.active { background:var(--card2); border-color:var(--accent3); }
  .sb-thumb {
    width:40px; height:28px; border-radius:4px;
    background:linear-gradient(135deg,#12122a,#1a1a40);
    display:flex; align-items:center; justify-content:center;
    font-size:16px; flex-shrink:0; border:1px solid var(--border);
  }
  .sb-info { flex:1; min-width:0; }
  .sb-name { font-size:12px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; margin-bottom:2px; }
  .sb-empty { text-align:center; padding:40px 0; color:var(--muted); font-size:11px; font-family:'Press Start 2P',monospace; line-height:2; }

  /* ‚ïê‚ïê RESPONSIVE ‚ïê‚ïê */
  @media (max-width:900px) { .sidebar{display:none;} .logo-block{width:auto;} }
  @media (max-width:600px) { .more-grid{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));} .gname{font-size:16px;} }
</style>
</head>
<body>

<div class="topbar">
  <div class="logo-block"><a class="logo" href="/">CLASSROM<em>.GG</em></a></div>
  <div class="topbar-mid">
    <a class="back-link" href="/">‚Üê Home</a>
    <div class="sep"></div>
    <div class="nav-title" id="nav-title">Loading...</div>
  </div>
  <div class="topbar-right">
    <span class="tbadge" id="top-badge"></span>
    <button class="ibtn" id="btn-fs">‚õ∂</button>
  </div>
</div>

<div class="page-body">

  <!-- CONTENT -->
  <div class="content-col">

    <div class="viewport-wrap" id="viewport">
      <div class="ov" id="ov">
        <div class="ov-icon" id="ov-icon">üéÆ</div>
        <div class="ov-label" id="ov-label">LOADING</div>
        <div class="ov-sub" id="ov-sub">Please wait...</div>
        <div class="ov-track"><div class="ov-bar"></div></div>
      </div>
      <div class="err-ov" id="err-ov">
        <div style="font-size:44px">‚ö†Ô∏è</div>
        <h2>LOAD FAILED</h2>
        <p id="err-msg">Could not load this game.</p>
        <a href="/" style="color:var(--accent);font-weight:700;margin-top:6px;font-size:14px">‚Üê Back to Home</a>
      </div>
      <iframe id="html5-frame" allowfullscreen allow="fullscreen; autoplay"
        sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-pointer-lock"></iframe>
      <div id="ruffle-wrap"></div>
    </div>

    <div class="info-bar">
      <div class="gname" id="gname">‚Äî</div>
      <button class="act-btn" id="share-btn">üîó Share</button>
      <button class="ibtn" id="btn-fs2">‚õ∂</button>
    </div>

    <div class="game-meta">
      <div class="chip" id="chip-type" style="display:none">üéÆ <span id="chip-type-text">‚Äî</span></div>
      <div class="chip">üÜì Free to Play</div>
      <div class="chip">üåê No Download</div>
      <div class="chip" id="chip-ruffle" style="display:none">‚ö° Ruffle Emulator</div>
    </div>

    <!-- MORE GAMES -->
    <div class="more-section">
      <div class="section-hd">
        <h2>MORE <span>GAMES</span></h2>
        <a class="view-all" href="/">View All ‚Üí</a>
      </div>
      <div class="more-grid" id="more-grid">
        <div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--muted);font-size:12px">Loading...</div>
      </div>
    </div>

  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="sb-head">
      <div class="sb-head-title">ALL <span>GAMES</span></div>
    </div>
    <div class="sb-search">
      <input type="text" id="sb-search" placeholder="üîç Search games..." autocomplete="off">
    </div>
    <div class="sb-tabs">
      <button class="stab active" data-f="all">All</button>
      <button class="stab t-html" data-f="html">HTML5</button>
      <button class="stab t-swf"  data-f="swf">Flash</button>
    </div>
    <div class="sb-list" id="sb-list">
      <div class="sb-empty">Loading...</div>
    </div>
  </div>

</div>

<script>
const CDN = 'https://cdn.jsdelivr.net/gh/classrom-gg/classrom-gg@main';
const EMOJIS = ['üéÆ','üïπÔ∏è','üëæ','üé≤','‚öîÔ∏è','üöÄ','üèéÔ∏è','üéØ','üß©','üåü','üî•','üíé','üêâ','ü¶ä','ü§ñ','üèÜ','üé™','üé≠','üåà','‚ö°'];

function emo(name) {
  let h=0; for(let c of name) h=(h*31+c.charCodeAt(0))&0xffff;
  return EMOJIS[h%EMOJIS.length];
}
function slug(name) {
  return name.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');
}

const P = new URLSearchParams(location.search);
let gamePath = P.get('path')||'';
let gameType = P.get('type')||'html';
let gameName = decodeURIComponent(P.get('name')||'Game');
const gameSlug = P.get('slug')||'';
let resolveFromSlug = gameSlug && !gamePath;
const gameUrl = gamePath ? (gamePath.startsWith('http')?gamePath:`${CDN}/${gamePath}`) : '';

function setMeta(name, type) {
  document.title = `${name} ‚Äî Classrom.GG`;
  document.getElementById('nav-title').textContent = name;
  document.getElementById('gname').textContent = name;
  const tb = document.getElementById('top-badge');
  if (type==='swf') {
    tb.textContent='FLASH'; tb.className='tbadge tbadge-swf';
    document.getElementById('chip-ruffle').style.display='flex';
  } else {
    tb.textContent='HTML5'; tb.className='tbadge tbadge-html';
  }
  const ct = document.getElementById('chip-type');
  ct.style.display='flex';
  document.getElementById('chip-type-text').textContent = type==='swf'?'Flash Game':'HTML5 Game';
}

function hideOv() {
  const o=document.getElementById('ov');
  o.classList.add('fade');
  setTimeout(()=>o.style.display='none',420);
}
function showErr(msg) {
  document.getElementById('ov').style.display='none';
  const e=document.getElementById('err-ov');
  e.classList.add('show');
  if(msg) document.getElementById('err-msg').textContent=msg;
}

function loadHTML5(url) {
  document.getElementById('ov-label').textContent='LOADING GAME';
  document.getElementById('ov-icon').textContent='üåê';
  const f=document.getElementById('html5-frame');
  f.style.display='block'; f.src=url;
  f.onload=()=>setTimeout(hideOv,400);
  f.onerror=()=>showErr('Could not load HTML5 game.');
  setTimeout(()=>{ if(!document.getElementById('ov').classList.contains('fade')) hideOv(); },7000);
}

function loadSWF(url) {
  document.getElementById('ov-label').textContent='STARTING RUFFLE';
  document.getElementById('ov-icon').textContent='‚ö°';
  document.getElementById('ov-sub').textContent='Loading Flash emulator...';
  const wrap=document.getElementById('ruffle-wrap');
  wrap.style.display='flex';
  window.RufflePlayer=window.RufflePlayer||{};
  const s=document.createElement('script');
  s.src='https://unpkg.com/@ruffle-rs/ruffle';
  s.onload=()=>{
    try {
      const r=window.RufflePlayer.newest();
      const p=r.createPlayer();
      p.style.width='100%'; p.style.height='100%';
      wrap.appendChild(p);
      p.load({url,allowScriptAccess:'always',backgroundColor:'#000000'})
       .then(()=>setTimeout(hideOv,300))
       .catch(e=>showErr('Ruffle error: '+e.message));
    } catch(e) { showErr('Ruffle init failed: '+e.message); }
  };
  s.onerror=()=>showErr('Could not load Ruffle emulator.');
  document.head.appendChild(s);
}

let allGames=[], sbFilter='all';

function renderSidebar(games) {
  const q=document.getElementById('sb-search').value.toLowerCase();
  const filtered=games.filter(g=>{
    return (sbFilter==='all'||g.type===sbFilter) && g.name.toLowerCase().includes(q);
  });
  const list=document.getElementById('sb-list');
  if(!filtered.length){ list.innerHTML='<div class="sb-empty">NO GAMES<br>FOUND</div>'; return; }
  list.innerHTML=filtered.map(g=>`
    <a class="sb-item${g.path===gamePath?' active':''}" href="/${slug(g.name)}">
      <div class="sb-thumb">${emo(g.name)}</div>
      <div class="sb-info">
        <div class="sb-name">${g.name}</div>
        <span class="mbadge mbadge-${g.type==='swf'?'swf':'html'}">${g.type==='swf'?'Flash':'HTML5'}</span>
      </div>
    </a>`).join('');
}

function renderMore(games) {
  const others=games.filter(g=>g.path!==gamePath).sort(()=>Math.random()-.5).slice(0,12);
  const grid=document.getElementById('more-grid');
  if(!others.length){grid.innerHTML='';return;}
  grid.innerHTML=others.map((g,i)=>`
    <a class="gcard" href="/${slug(g.name)}" style="animation-delay:${i*.04}s">
      <div class="gcard-thumb">${emo(g.name)}</div>
      <div class="gcard-body">
        <div class="gcard-name">${g.name}</div>
        <span class="mbadge mbadge-${g.type==='swf'?'swf':'html'}">${g.type==='swf'?'Flash':'HTML5'}</span>
      </div>
    </a>`).join('');
}

async function loadGames() {
  try {
    const res=await fetch('/games.json');
    const data=await res.json();
    allGames=data.games||[];
    if(resolveFromSlug) {
      const match=allGames.find(g=>slug(g.name)===gameSlug);
      if(match) {
        gamePath=match.path; gameType=match.type; gameName=match.name;
        setMeta(gameName,gameType);
        gameType==='swf'?loadSWF(`${CDN}/${match.path}`):loadHTML5(`${CDN}/${match.path}`);
      } else showErr(`Game "${gameSlug}" not found.`);
    }
    renderSidebar(allGames);
    renderMore(allGames);
  } catch(e) {
    document.getElementById('sb-list').innerHTML='<div class="sb-empty">LOAD ERROR</div>';
    document.getElementById('more-grid').innerHTML='';
  }
}

document.getElementById('sb-search').addEventListener('input',()=>renderSidebar(allGames));
document.querySelectorAll('.stab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.stab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active'); sbFilter=btn.dataset.f;
    renderSidebar(allGames);
  });
});

document.getElementById('share-btn').addEventListener('click',()=>{
  navigator.clipboard.writeText(location.href).then(()=>{
    const b=document.getElementById('share-btn');
    b.textContent='‚úì Copied!'; b.classList.add('ok');
    setTimeout(()=>{b.textContent='üîó Share';b.classList.remove('ok');},2200);
  });
});

function toggleFS() {
  const vp=document.getElementById('viewport');
  if(!document.fullscreenElement) vp.requestFullscreen().catch(()=>{});
  else document.exitFullscreen();
}
document.getElementById('btn-fs').addEventListener('click',toggleFS);
document.getElementById('btn-fs2').addEventListener('click',toggleFS);
document.addEventListener('fullscreenchange',()=>{
  const l=document.fullscreenElement?'‚úï':'‚õ∂';
  document.getElementById('btn-fs').textContent=l;
  document.getElementById('btn-fs2').textContent=l;
});

if(!resolveFromSlug&&!gamePath) showErr('No game specified.');
else if(!resolveFromSlug) { setMeta(gameName,gameType); gameType==='swf'?loadSWF(gameUrl):loadHTML5(gameUrl); }
loadGames();
</script>
</body>
</html>