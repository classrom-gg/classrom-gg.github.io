<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading... ‚Äî Classrom.GG</title>
<meta name="description" content="Play free games online at Classrom.GG">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root[data-theme="dark"] {
    --bg: #0a0a0f;
    --bg2: #0f0f1a;
    --card: #13131f;
    --border: #1e1e32;
    --accent: #00ffaa;
    --accent2: #ff3e6c;
    --accent3: #7c3aed;
    --text: #e2e8f0;
    --muted: #64748b;
    --glow: 0 0 20px rgba(0,255,170,0.25);
  }
  :root[data-theme="light"] {
    --bg: #f0f4f8;
    --bg2: #e8edf4;
    --card: #ffffff;
    --border: #d1d9e6;
    --accent: #059669;
    --accent2: #e11d48;
    --accent3: #7c3aed;
    --text: #1e293b;
    --muted: #64748b;
    --glow: 0 0 20px rgba(5,150,105,0.2);
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    transition: background 0.3s, color 0.3s;
  }
  [data-theme="dark"] body::before {
    content:'';
    position:fixed;
    inset:0;
    background: repeating-linear-gradient(
      0deg, transparent, transparent 2px,
      rgba(0,0,0,0.08) 2px, rgba(0,0,0,0.08) 4px
    );
    pointer-events:none;
    z-index:1; /* Kh√¥ng ƒë√® iframe game */
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    background: var(--bg);
    position: sticky;
    top: 0;
    z-index: 100;
    transition: background 0.3s, border-color 0.3s;
  }
  .logo {
    font-family: 'Press Start 2P', monospace;
    font-size: 13px;
    color: var(--accent);
    text-shadow: 0 0 20px rgba(0,255,170,0.5);
    text-decoration: none;
  }
  [data-theme="light"] .logo { text-shadow: none; }
  .logo span { color: var(--accent2); }
  .header-right { display:flex; gap:16px; align-items:center; }
  .back-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--muted);
    text-decoration: none;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 1px;
    text-transform: uppercase;
    transition: color 0.2s;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 7px 14px;
  }
  .back-btn:hover { color: var(--accent); border-color: var(--accent); }
  .theme-toggle {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 6px 14px;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700;
    letter-spacing: 1px;
  }
  .theme-toggle:hover { border-color: var(--accent); }

  /* ‚îÄ‚îÄ BREADCRUMB ‚îÄ‚îÄ */
  .breadcrumb {
    padding: 14px 32px;
    font-size: 12px;
    color: var(--muted);
    font-weight: 700;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
  }
  .breadcrumb a { color: var(--accent); text-decoration: none; }
  .breadcrumb a:hover { text-decoration: underline; }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .game-layout {
    max-width: 1300px;
    margin: 0 auto;
    padding: 32px 32px 60px;
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 28px;
    align-items: start;
  }

  /* ‚îÄ‚îÄ GAME CONTAINER ‚îÄ‚îÄ */
  .game-wrap {
    position: relative;
  }
  .game-title {
    font-family: 'Press Start 2P', monospace;
    font-size: clamp(12px, 1.8vw, 18px);
    color: var(--text);
    margin-bottom: 16px;
    line-height: 1.5;
  }
  .game-title em {
    font-style: normal;
    color: var(--accent);
  }

  .game-frame-wrap {
    position: relative;
    background: #000;
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 32px rgba(0,0,0,0.4);
    /* T·∫°o stacking context ri√™ng ‚Äî ngƒÉn ::before body ph·ªß v√†o */
    isolation: isolate;
    z-index: 2;
  }
  .game-frame-inner {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    background: #000;
  }
  /* iframe/canvas/ruffle: tuy·ªát ƒë·ªëi s·∫°ch ‚Äî kh√¥ng filter, kh√¥ng opacity */
  .game-frame-inner iframe,
  .game-frame-inner canvas,
  .game-frame-inner ruffle-player,
  .game-frame-inner .ruffle-container,
  .game-frame-inner .ruffle-container * {
    position: absolute;
    inset: 0;
    width: 100% !important;
    height: 100% !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    display: block;
    opacity: 1 !important;
    filter: none !important;
    mix-blend-mode: normal !important;
    background-blend-mode: normal !important;
    -webkit-filter: none !important;
    image-rendering: auto;
  }

  /* Fullscreen button */
  .game-toolbar {
    display: flex;
    gap: 10px;
    align-items: center;
    padding: 12px 0 0;
    flex-wrap: wrap;
  }
  .tool-btn {
    padding: 8px 18px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--muted);
    font-family: 'Rajdhani', sans-serif;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .tool-btn:hover { border-color: var(--accent); color: var(--accent); }
  .tool-btn.primary {
    background: var(--accent3);
    border-color: var(--accent3);
    color: #fff;
  }
  .tool-btn.primary:hover {
    box-shadow: 0 0 16px rgba(124,58,237,0.4);
  }

  /* Description */
  .game-description {
    margin-top: 24px;
    padding: 20px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
  }
  .game-description h3 {
    font-family: 'Press Start 2P', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }
  .game-description p {
    color: var(--muted);
    font-size: 15px;
    font-weight: 600;
    line-height: 1.7;
  }

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  .sidebar {}
  .sidebar-section {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 18px;
    margin-bottom: 20px;
  }
  .sidebar-title {
    font-family: 'Press Start 2P', monospace;
    font-size: 9px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 14px;
  }
  .sidebar-title span { color: var(--accent); }

  /* Game info */
  .info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
    font-weight: 700;
  }
  .info-row:last-child { border-bottom: none; }
  .info-label { color: var(--muted); letter-spacing: 0.5px; text-transform: uppercase; font-size: 11px; }
  .info-val { color: var(--text); }

  /* Related games */
  .related-card {
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    text-decoration: none;
    color: inherit;
    transition: all 0.15s;
  }
  .related-card:last-child { border-bottom: none; }
  .related-card:hover .related-name { color: var(--accent); }
  .related-thumb {
    width: 64px;
    height: 36px;
    border-radius: 4px;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    overflow: hidden;
    border: 1px solid var(--border);
  }
  .related-thumb img { width:100%; height:100%; object-fit:cover; }
  .related-name {
    font-size: 13px;
    font-weight: 700;
    transition: color 0.15s;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .related-type {
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 3px;
  }

  /* Badge */
  .badge {
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 2px 8px;
    border-radius: 4px;
  }
  .badge-html5 { background: rgba(14,165,233,0.15); color: #38bdf8; border: 1px solid rgba(14,165,233,0.3); }
  .badge-flash { background: rgba(255,62,108,0.15); color: #fb7185; border: 1px solid rgba(255,62,108,0.3); }

  /* Not found */
  .not-found {
    text-align: center;
    padding: 100px 32px;
    color: var(--muted);
  }
  .not-found-icon { font-size: 64px; display: block; margin-bottom: 24px; opacity: 0.4; }
  .not-found h2 {
    font-family: 'Press Start 2P', monospace;
    font-size: 14px;
    margin-bottom: 16px;
    color: var(--text);
  }
  .not-found p { font-size: 15px; font-weight: 600; margin-bottom: 24px; }
  .not-found a {
    display: inline-block;
    padding: 12px 28px;
    border: 1px solid var(--accent3);
    border-radius: 8px;
    color: var(--accent3);
    text-decoration: none;
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 1px;
    text-transform: uppercase;
    transition: all 0.2s;
  }
  .not-found a:hover { background: var(--accent3); color: #fff; }

  /* Loading */
  .loading-screen {
    text-align: center;
    padding: 100px 32px;
    font-family: 'Press Start 2P', monospace;
    font-size: 11px;
    color: var(--muted);
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:0.4} 50%{opacity:1} }

  /* Footer */
  footer {
    border-top: 1px solid var(--border);
    padding: 24px 32px;
    text-align: center;
    color: var(--muted);
    font-size: 13px;
    font-weight: 600;
  }
  footer a { color: var(--accent); text-decoration: none; }

  /* Responsive */
  @media (max-width: 900px) {
    .game-layout { grid-template-columns: 1fr; }
    .sidebar { order: 2; }
  }
  @media (max-width: 600px) {
    header { padding: 14px 16px; }
    .breadcrumb, .game-layout { padding-left: 14px; padding-right: 14px; }
    .logo { font-size: 11px; }
  }
</style>
</head>
<body>

<header>
  <a class="logo" href="index.html">CLASSROM<span>.GG</span></a>
  <div class="header-right">
    <a class="back-btn" href="index.html">‚Üê All Games</a>
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
      <span id="themeIcon">‚òÄÔ∏è</span>
      <span id="themeLabel">LIGHT</span>
    </button>
  </div>
</header>

<div class="breadcrumb" id="breadcrumb">
  <a href="index.html">Home</a> ‚Ä∫ <span id="bread-name">Loading...</span>
</div>

<div id="app">
  <div class="loading-screen">Loading game...</div>
</div>

<footer>
  <p>¬© 2025 Classrom.GG &nbsp;¬∑&nbsp; Powered by <a href="https://ruffle.rs" target="_blank">Ruffle</a> Flash Emulator &nbsp;¬∑&nbsp; <a href="https://github.com/classrom-gg/classrom-gg" target="_blank">GitHub</a></p>
</footer>

<!-- Ruffle Flash Emulator -->
<script src="https://unpkg.com/@ruffle-rs/ruffle"></script>

<script>
// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
function getStoredTheme() { return localStorage.getItem('cgTheme') || 'dark'; }
function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  const icon = document.getElementById('themeIcon');
  const label = document.getElementById('themeLabel');
  if (theme === 'dark') { icon.textContent = '‚òÄÔ∏è'; label.textContent = 'LIGHT'; }
  else { icon.textContent = 'üåô'; label.textContent = 'DARK'; }
  localStorage.setItem('cgTheme', theme);
}
function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  applyTheme(current === 'dark' ? 'light' : 'dark');
}
applyTheme(getStoredTheme());

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
const EMOJIS = ['üéÆ','üïπÔ∏è','üëæ','üé≤','‚öîÔ∏è','üöÄ','üèéÔ∏è','üéØ','üß©','üåü','üî•','üíé','üêâ','ü¶ä','ü§ñ'];
function getEmoji(name) {
  let hash = 0;
  for (let c of name) hash = (hash * 31 + c.charCodeAt(0)) & 0xffff;
  return EMOJIS[hash % EMOJIS.length];
}
function toSlug(n) { return n.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,''); }
function getParam(key) { return new URLSearchParams(window.location.search).get(key); }

// ‚îÄ‚îÄ FULLSCREEN ‚îÄ‚îÄ
function goFullscreen() {
  const el = document.getElementById('game-frame-wrap');
  if (!el) return;
  if (el.requestFullscreen) el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
}

// ‚îÄ‚îÄ RENDER GAME ‚îÄ‚îÄ
function renderGame(game, related) {
  const slug = game.slug || toSlug(game.name);
  const isFlash = game.type === 'swf';

  // URL: ∆∞u ti√™n game.url n·∫øu c√≥, fallback v·ªÅ data/games/<slug>/index.html ho·∫∑c .swf
  const gameUrl = game.url
    ? game.url
    : isFlash
      ? `data/games/${slug}/${slug}.swf`
      : `data/games/${slug}/index.html`;

  // Page meta
  document.title = `${game.name} ‚Äî Classrom.GG`;
  document.querySelector('meta[name="description"]').setAttribute('content',
    `Play ${game.name} free online at Classrom.GG. ${isFlash ? 'Flash' : 'HTML5'} game, no download required.`);
  document.getElementById('bread-name').textContent = game.name;

  // Related cards html
  const relatedHtml = related.slice(0, 6).map(g => {
    const gs = g.slug || toSlug(g.name);
    const thumbSrc = g.thumb || `data/thumbs/${gs}.png`;
    return `<a class="related-card" href="game.html?slug=${gs}">
      <div class="related-thumb">
        <img src="${thumbSrc}" alt="${g.name}"
          onerror="this.style.display='none';this.nextSibling.style.display='flex'">
        <span style="display:none;align-items:center;justify-content:center;font-size:18px;width:100%;height:100%">${getEmoji(g.name)}</span>
      </div>
      <div>
        <div class="related-name">${g.name}</div>
        <div class="related-type">${g.type === 'swf' ? 'üéÆ Flash' : 'üåê HTML5'}</div>
      </div>
    </a>`;
  }).join('');

  // Game embed
  let gameEmbed = '';
  if (isFlash) {
    gameEmbed = `<div id="ruffle-container" style="position:absolute;inset:0;width:100%;height:100%"></div>`;
  } else {
    gameEmbed = `<iframe id="game-iframe" src="${gameUrl}" allowfullscreen
      allow="fullscreen; autoplay; gamepad"
      sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups"
      loading="lazy"></iframe>`;
  }

  document.getElementById('app').innerHTML = `
    <div class="game-layout">
      <!-- MAIN -->
      <div class="game-wrap">
        <h1 class="game-title">‚ñ∂ <em>${game.name}</em></h1>

        <div class="game-frame-wrap" id="game-frame-wrap">
          <div class="game-frame-inner">
            ${gameEmbed}
          </div>
        </div>

        <div class="game-toolbar">
          <button class="tool-btn primary" onclick="goFullscreen()">‚õ∂ Fullscreen</button>
          <span class="badge badge-${isFlash ? 'flash' : 'html5'}">${isFlash ? 'üéÆ FLASH' : 'üåê HTML5'}</span>
          <a class="tool-btn" href="index.html">‚Üê Back to Games</a>
        </div>

        ${game.description ? `
        <div class="game-description">
          <h3>About this game</h3>
          <p>${game.description}</p>
        </div>` : ''}
      </div>

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">GAME INFO</div>
          <div class="info-row">
            <span class="info-label">Type</span>
            <span class="info-val">
              <span class="badge badge-${isFlash ? 'flash' : 'html5'}">${isFlash ? 'FLASH' : 'HTML5'}</span>
            </span>
          </div>
          <div class="info-row">
            <span class="info-label">Name</span>
            <span class="info-val">${game.name}</span>
          </div>
          ${game.category ? `<div class="info-row">
            <span class="info-label">Category</span>
            <span class="info-val">${game.category}</span>
          </div>` : ''}
          ${game.developer ? `<div class="info-row">
            <span class="info-label">Developer</span>
            <span class="info-val">${game.developer}</span>
          </div>` : ''}
        </div>

        ${related.length ? `
        <div class="sidebar-section">
          <div class="sidebar-title">MORE <span>GAMES</span></div>
          ${relatedHtml}
        </div>` : ''}
      </aside>
    </div>`;

  // Init Ruffle for Flash games
  if (isFlash) {
    try {
      const ruffle = window.RufflePlayer.newest();
      const player = ruffle.createPlayer();
      player.style.width = '100%';
      player.style.height = '100%';
      document.getElementById('ruffle-container').appendChild(player);
      player.load(gameUrl);
    } catch(e) {
      document.getElementById('ruffle-container').innerHTML =
        `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#fb7185;font-family:'Press Start 2P';font-size:10px;text-align:center;padding:20px">
          RUFFLE NOT LOADED<br><br>
          <small style="font-size:8px;font-family:sans-serif;opacity:0.7">
            Add Ruffle script to enable Flash
          </small>
        </div>`;
    }
  }
}

// ‚îÄ‚îÄ LOAD ‚îÄ‚îÄ
async function init() {
  const slug = getParam('slug');
  if (!slug) { showNotFound(); return; }

  try {
    const res = await fetch('games.json');
    if (!res.ok) throw new Error();
    const data = await res.json();
    const games = data.games || [];

    const game = games.find(g => (g.slug || toSlug(g.name)) === slug);
    if (!game) { showNotFound(); return; }

    // Shuffle related (same type preferred, then random)
    const related = games
      .filter(g => (g.slug || toSlug(g.name)) !== slug)
      .sort((a, b) => (b.type === game.type ? 1 : 0) - (a.type === game.type ? 1 : 0))
      .slice(0, 12)
      .sort(() => Math.random() - 0.5);

    renderGame(game, related);
  } catch(e) {
    document.getElementById('app').innerHTML = `
      <div class="not-found">
        <span class="not-found-icon">‚ö†Ô∏è</span>
        <h2>LOAD ERROR</h2>
        <p>Could not load games.json</p>
        <a href="index.html">‚Üê Back to Home</a>
      </div>`;
  }
}

function showNotFound() {
  document.title = 'Game Not Found ‚Äî Classrom.GG';
  document.getElementById('app').innerHTML = `
    <div class="not-found">
      <span class="not-found-icon">üëæ</span>
      <h2>GAME NOT FOUND</h2>
      <p>This game doesn't exist or has been removed.</p>
      <a href="index.html">‚Üê Back to All Games</a>
    </div>`;
}

init();
</script>
</body>
</html>